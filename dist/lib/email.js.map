{"version":3,"sources":["lib/email.js"],"names":["accountConfirmationEmail","promoWistiKeys","forgotPasswordEmail","newFriendEmail","foundWistikiEmail","tutoEmail","positionUpdateEmail","AWS","config","loadFromPath","ses","SES","debug","require","transport","nodemailer","createTransport","templates","email","template","confirmation_template","wistikeys_template","reset_template","tuto_template","new_friend_template","found_wistiki_template","position_update_template","attachments","filename","path","resolve","cid","generateUrl","url","baseUrl","process","env","NODE_ENV","params","emailFn","jade","compileFile","html","confirmation_token","MAIL_CONFIRMATION_GREETINGS","i18n","__","phrase","locale","language","first_name","MAIL_CONFIRMATION_BODY","MAIL_CONFIRMATION_BUTTON","MAIL_CONFIRMATION_LOSE_RELAX","MAIL_CONFIRMATION_WISTIKI","MAIL_CONFIRMATION_SOCIAL","from","to","subject","reject","sendMail","err","info","console","log","MAIL_WISTIKEYS_GREETINGS","MAIL_WISTIKEYS_BODY","MAIL_WISTIKEYS_BUTTON","MAIL_WISTIKEYS_LOSE_RELAX","MAIL_WISTIKEYS_WISTIKI","MAIL_WISTIKEYS_SOCIAL","password_reset_token","MAIL_RESET_GREETINGS","user","MAIL_RESET_BODY","MAIL_RESET_BUTTON","WISTIKI","LOSE_AND_RELAX","url_google","url_apple","img_google","img_apple","MAIL_NEWFRIEND_BODY","MAIL_NEWFRIEND_BODY_CONTENT_1","wistiki","MAIL_NEWFRIEND_BODY_CONTENT_2","MAIL_NEWFRIEND_BODY_CONTENT_3","MAIL_FOUND_BODY","MAIL_FOUND_BODY_CONTENT_1","MAIL_FOUND_BODY_CONTENT_2","MAIL_FOUND_BODY_CONTENT_3","MAIL_TUTO_BODY","MAIL_TUTO_BODY_CONTENT","MAIL_TUTO_ADD","MAIL_TUTO_RING","MAIL_TUTO_SHARE","MAIL_TUTO_LINK","MAIL_TUTO_BUTTON","MAIL_POSITION_UPDATE_BODY","MAIL_POSITION_UPDATE_CONTENT_1","MAIL_POSITION_UPDATE_CONTENT_2","MAIL_POSITION_UPDATE_CONTENT_3","MAIL_POSITION_UPDATE_CONTENT_4","sendAccountConfirmationEmail","sendPromoWistiKeys","sendForgotPasswordEmail","sendNewFriendEmail","sendFoundWistikiEmail","sendTutoEmail","sendPositionUpdateEmail"],"mappings":"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","file":"email.js","sourcesContent":["/**\n * Wistiki SAS\n * Created by adnene on 08/12/2015.\n */\nimport AWS from 'aws-sdk';\nimport jade from 'jade';\nimport path from 'path';\n\nimport nodemailer from 'nodemailer';\nimport sesTransport from 'nodemailer-ses-transport';\nimport i18n from '../lib/i18n';\n\nAWS.config.loadFromPath('./dist/config/aws_credentials.json');\nconst ses = new AWS.SES();\nconst debug = require('debug')('darwin:email');\n\nconst transport = nodemailer.createTransport(sesTransport({\n  ses,\n}));\nconst templates = {\n  email: {\n    template: './static/html/verify/email.jade',\n    confirmation_template: './static/html/user/confirmation.jade',\n    wistikeys_template: './static/html/user/wistikeys.jade',\n    reset_template: './static/html/user/reset_password.jade',\n    tuto_template: './static/html/user/tuto.jade',\n    new_friend_template: './static/html/share/new_friend.jade',\n    found_wistiki_template: './static/html/wistiki/found.jade',\n    position_update_template: './static/html/wistiki/position_update.jade',\n    attachments: [\n      {\n        filename: 'dfd8a5d8af444e5e8ee95c527174a3e0.png',\n        path: path.resolve('./static/img/dfd8a5d8af444e5e8ee95c527174a3e0.png'),\n        cid: 'dfd8a5d8af444e5e8ee95c527174a3e0', // should be as unique as possible\n      },\n      {\n        filename: 'facebook.png',\n        path: path.resolve('./static/img/facebook.png'),\n        cid: 'facebook', // should be as unique as possible\n      },\n      {\n        filename: 'twitter.png',\n        path: path.resolve('./static/img/twitter.png'),\n        cid: 'twitter', // should be as unique as possible\n      },\n      {\n        filename: 'linkedin.png',\n        path: path.resolve('./static/img/linkedin.png'),\n        cid: 'linkedin', // should be as unique as possible\n      },\n    ],\n  },\n};\nconst generateUrl = function (url = '/') {\n  const baseUrl = `${process.env.NODE_ENV == 'production' ? 'https' : 'http'}://web.wistiki.${process.env.NODE_ENV == 'production' ? 'com' : 'io'}`;\n  return `${baseUrl + url}`;\n};\n\n/**\n * Sends a confirmation email to user based on provided param\n *\n * @param params - Object {email: string, confirmation_token: string , subject: string (optional)}\n * @returns {Promise}\n */\nexport function accountConfirmationEmail(params) {\n  debug('accountConfirmationEmail', JSON.stringify(params, null, 2));\n  const emailFn = jade.compileFile(path.resolve(templates.email.confirmation_template));\n  // TODO: Translate message\n  const html = emailFn({\n    url: generateUrl(`/activation/${params.email}/${params.confirmation_token}`),\n    MAIL_CONFIRMATION_GREETINGS: i18n.__({\n      phrase: 'MAIL_CONFIRMATION_GREETINGS',\n      locale: params.language,\n    }, `${params.first_name}`),\n    MAIL_CONFIRMATION_BODY: i18n.__({ phrase: 'MAIL_CONFIRMATION_BODY', locale: params.language }),\n    MAIL_CONFIRMATION_BUTTON: i18n.__({\n      phrase: 'MAIL_CONFIRMATION_BUTTON',\n      locale: params.language,\n    }),\n    MAIL_CONFIRMATION_LOSE_RELAX: i18n.__({\n      phrase: 'MAIL_CONFIRMATION_LOSE_RELAX',\n      locale: params.language,\n    }),\n    MAIL_CONFIRMATION_WISTIKI: i18n.__({\n      phrase: 'MAIL_CONFIRMATION_WISTIKI',\n      locale: params.language,\n    }),\n    MAIL_CONFIRMATION_SOCIAL: i18n.__({\n      phrase: 'MAIL_CONFIRMATION_SOCIAL',\n      locale: params.language,\n    }),\n  });\n  const email = {\n    from: 'L\\'équipe Wistiki <notification@wistiki.com>',\n    to: params.email,\n    subject: i18n.__({ phrase: 'MAIL_CONFIRMATION_SUBJECT', locale: params.language }),\n    html,\n    // attachments: templates.email.attachments\n  };\n  return new Promise((resolve, reject) => {\n    transport.sendMail(email, (err, info) => {\n      if (err) {\n        console.log(err);\n        reject(err);\n      } else {\n        // console.log(info);\n      }\n      resolve(info);\n    });\n  });\n}\n\n/**\n * Sends a voucher by email to user based on provided param after creating an account\n *\n * @param params - Object {email: string, subject: string (optional)}\n * @returns {Promise}\n */\nexport function promoWistiKeys(params) {\n  debug('promoWistiKeys', JSON.stringify(params, null, 2));\n  const emailFn = jade.compileFile(path.resolve(templates.email.wistikeys_template));\n  // TODO: Translate message\n  const html = emailFn({\n    url: 'https://www.securkeys.com/wistikipromo',\n    MAIL_WISTIKEYS_GREETINGS: i18n.__({\n      phrase: 'MAIL_WISTIKEYS_GREETINGS',\n      locale: params.language,\n    }, `${params.first_name}`),\n    MAIL_WISTIKEYS_BODY: i18n.__({ phrase: 'MAIL_WISTIKEYS_BODY', locale: params.language }),\n    MAIL_WISTIKEYS_BUTTON: i18n.__({\n      phrase: 'MAIL_WISTIKEYS_BUTTON',\n      locale: params.language,\n    }),\n    MAIL_WISTIKEYS_LOSE_RELAX: i18n.__({\n      phrase: 'MAIL_WISTIKEYS_LOSE_RELAX',\n      locale: params.language,\n    }),\n    MAIL_WISTIKEYS_WISTIKI: i18n.__({\n      phrase: 'MAIL_WISTIKEYS_WISTIKI',\n      locale: params.language,\n    }),\n    MAIL_WISTIKEYS_SOCIAL: i18n.__({\n      phrase: 'MAIL_WISTIKEYS_SOCIAL',\n      locale: params.language,\n    }),\n  });\n  const email = {\n    from: 'L\\'équipe Wistiki <notification@wistiki.com>',\n    to: params.email,\n    subject: i18n.__({ phrase: 'MAIL_WISTIKEYS_SUBJECT', locale: params.language }),\n    html,\n    // attachments: templates.email.attachments\n  };\n  return new Promise((resolve, reject) => {\n    transport.sendMail(email, (err, info) => {\n      if (err) {\n        console.log(err);\n        reject(err);\n      } else {\n        // console.log(info);\n      }\n      resolve(info);\n    });\n  });\n}\n\n/**\n * Send a forgot password to user based on provided param\n *\n * @param params - Object {email: string, password_reset_token: string , subject: string (optional)}\n * @returns {Promise}\n */\nexport function forgotPasswordEmail(params) {\n  const emailFn = jade.compileFile(path.resolve(templates.email.reset_template));\n  const html = emailFn({\n    url: generateUrl(`/reset_password/${params.email}/${params.password_reset_token}`),\n    MAIL_RESET_GREETINGS: i18n.__({\n      phrase: 'MAIL_RESET_GREETINGS',\n      locale: params.language,\n    }, `${params.user.first_name}`),\n    MAIL_RESET_BODY: i18n.__({ phrase: 'MAIL_RESET_BODY', locale: params.language }),\n    MAIL_RESET_BUTTON: i18n.__({ phrase: 'MAIL_RESET_BUTTON', locale: params.language }),\n    WISTIKI: i18n.__({ phrase: 'WISTIKI', locale: params.language }),\n    LOSE_AND_RELAX: i18n.__({ phrase: 'LOSE_AND_RELAX', locale: params.language }),\n  });\n  const email = {\n    from: 'L\\'équipe Wistiki <notification@wistiki.com>',\n    to: params.email,\n    subject: i18n.__({ phrase: 'MAIL_RESET_SUBJECT', locale: params.language }),\n    html,\n  };\n  return new Promise((resolve, reject) => {\n    transport.sendMail(email, (err, info) => {\n      if (err) {\n        reject(err);\n      }\n      resolve(info);\n    });\n  });\n}\n\n\n/**\n * Send a download app invitation to new shared with user based on provided param\n *\n * @param params - Object {email: string, user, subject: string (optional)}\n * @returns {Promise}\n */\nexport function newFriendEmail(params) {\n  debug('newFriendEmail', params);\n  const emailFn = jade.compileFile(path.resolve(templates.email.new_friend_template));\n  const html = emailFn({\n    url_google: i18n.__({ phrase: 'URL_GOOGLE_PLAY', locale: params.language }),\n    url_apple: i18n.__({ phrase: 'URL_APPLE_STORE', locale: params.language }),\n    img_google: i18n.__({ phrase: 'MAIL_NEWFRIEND_GOOGLE', locale: params.language }),\n    img_apple: i18n.__({ phrase: 'MAIL_NEWFRIEND_APPLE', locale: params.language }),\n    MAIL_NEWFRIEND_BODY: i18n.__({ phrase: 'MAIL_NEWFRIEND_BODY', locale: params.language }),\n    MAIL_NEWFRIEND_BODY_CONTENT_1: i18n.__({\n      phrase: 'MAIL_NEWFRIEND_BODY_CONTENT_1',\n      locale: params.language,\n    }, `${params.user.first_name}`, `${params.wistiki}`),\n    MAIL_NEWFRIEND_BODY_CONTENT_2: i18n.__({\n      phrase: 'MAIL_NEWFRIEND_BODY_CONTENT_2',\n      locale: params.language,\n    }),\n    MAIL_NEWFRIEND_BODY_CONTENT_3: i18n.__({\n      phrase: 'MAIL_NEWFRIEND_BODY_CONTENT_3',\n      locale: params.language,\n    }),\n    LOSE_AND_RELAX: i18n.__({ phrase: 'LOSE_AND_RELAX', locale: params.language }),\n    WISTIKI: i18n.__({ phrase: 'WISTIKI', locale: params.language }),\n  });\n  const email = {\n    from: 'L\\'équipe Wistiki <notification@wistiki.com>',\n    to: params.email,\n    subject: i18n.__({\n      phrase: 'MAIL_NEWFRIEND_SUBJECT',\n      locale: params.language,\n    }, `${params.user.first_name}`, `${params.wistiki}`),\n    html,\n  };\n  return new Promise((resolve, reject) => {\n    transport.sendMail(email, (err, info) => {\n      if (err) {\n        reject(err);\n      }\n      resolve(info);\n    });\n  });\n}\n\n/**\n * Send a found wistiki email based on provided param\n *\n * @param params - Object {email: string, wistiki: string, subject: string (optional)}\n * @returns {Promise}\n */\nexport function foundWistikiEmail(params) {\n  debug('foundWistikiEmail', params);\n  const emailFn = jade.compileFile(path.resolve(templates.email.found_wistiki_template));\n  const html = emailFn({\n    MAIL_FOUND_BODY: i18n.__({\n      phrase: 'MAIL_FOUND_BODY',\n      locale: params.language,\n    }, `${params.wistiki}`),\n    MAIL_FOUND_BODY_CONTENT_1: i18n.__({\n      phrase: 'MAIL_FOUND_BODY_CONTENT_1',\n      locale: params.language,\n    }, `${params.wistiki}`),\n    MAIL_FOUND_BODY_CONTENT_2: i18n.__({\n      phrase: 'MAIL_FOUND_BODY_CONTENT_2',\n      locale: params.language,\n    }),\n    MAIL_FOUND_BODY_CONTENT_3: i18n.__({\n      phrase: 'MAIL_FOUND_BODY_CONTENT_3',\n      locale: params.language,\n    }),\n    LOSE_AND_RELAX: i18n.__({ phrase: 'LOSE_AND_RELAX', locale: params.language }),\n    WISTIKI: i18n.__({ phrase: 'WISTIKI', locale: params.language }),\n  });\n  const email = {\n    from: 'L\\'équipe Wistiki <notification@wistiki.com>',\n    to: params.email,\n    subject: i18n.__({\n      phrase: 'MAIL_FOUND_SUBJECT',\n      locale: params.language,\n    }, `${params.wistiki}`),\n    html,\n  };\n  return new Promise((resolve, reject) => {\n    transport.sendMail(email, (err, info) => {\n      if (err) {\n        reject(err);\n      }\n      resolve(info);\n    });\n  });\n}\n\n/**\n * Send an invitation to chekout tutorial videos of wistiki based on provided param\n *\n * @param params - Object {email: string, user, subject: string (optional)}\n * @returns {Promise}\n */\nexport function tutoEmail(params) {\n  debug('tutoEmail', params);\n  const emailFn = jade.compileFile(path.resolve(templates.email.tuto_template));\n  const html = emailFn({\n    MAIL_TUTO_BODY: i18n.__({\n      phrase: 'MAIL_TUTO_BODY',\n      locale: params.language,\n    }, `${params.wistiki}`),\n    MAIL_TUTO_BODY_CONTENT: i18n.__({ phrase: 'MAIL_TUTO_BODY_CONTENT', locale: params.language }),\n    MAIL_TUTO_ADD: i18n.__({ phrase: 'MAIL_TUTO_ADD', locale: params.language }),\n    MAIL_TUTO_RING: i18n.__({ phrase: 'MAIL_TUTO_RING', locale: params.language }),\n    MAIL_TUTO_SHARE: i18n.__({ phrase: 'MAIL_TUTO_SHARE', locale: params.language }),\n    MAIL_TUTO_LINK: i18n.__({ phrase: 'MAIL_TUTO_LINK', locale: params.language }),\n    MAIL_TUTO_BUTTON: i18n.__({ phrase: 'MAIL_TUTO_BUTTON', locale: params.language }),\n    LOSE_AND_RELAX: i18n.__({ phrase: 'LOSE_AND_RELAX', locale: params.language }),\n    WISTIKI: i18n.__({ phrase: 'WISTIKI', locale: params.language }),\n  });\n  const email = {\n    from: 'L\\'équipe Wistiki <notification@wistiki.com>',\n    to: params.email,\n    subject: i18n.__({\n      phrase: 'MAIL_TUTO_SUBJECT',\n      locale: params.language,\n    }, `${params.user.first_name}`),\n    html,\n  };\n  return new Promise((resolve, reject) => {\n    transport.sendMail(email, (err, info) => {\n      if (err) {\n        reject(err);\n      }\n      resolve(info);\n    });\n  });\n}\n\n\n/**\n * Send a wistiki position update email based on provided param\n *\n * @param params - Object {email: string, wistiki: string, subject: string (optional)}\n * @returns {Promise}\n */\nexport function positionUpdateEmail(params) {\n  debug('positionUpdateEmail', params);\n  const emailFn = jade.compileFile(path.resolve(templates.email.position_update_template));\n  const html = emailFn({\n    MAIL_POSITION_UPDATE_BODY: i18n.__({\n      phrase: 'MAIL_POSITION_UPDATE_BODY',\n      locale: params.language,\n    }, `${params.wistiki}`),\n    MAIL_POSITION_UPDATE_CONTENT_1: i18n.__({\n      phrase: 'MAIL_POSITION_UPDATE_CONTENT_1',\n      locale: params.language,\n    }, `${params.wistiki}`),\n    MAIL_POSITION_UPDATE_CONTENT_2: i18n.__({\n      phrase: 'MAIL_POSITION_UPDATE_CONTENT_2',\n      locale: params.language,\n    }),\n    MAIL_POSITION_UPDATE_CONTENT_3: i18n.__({\n      phrase: 'MAIL_POSITION_UPDATE_CONTENT_3',\n      locale: params.language,\n    }),\n    MAIL_POSITION_UPDATE_CONTENT_4: i18n.__({\n      phrase: 'MAIL_POSITION_UPDATE_CONTENT_4',\n      locale: params.language,\n    }),\n    LOSE_AND_RELAX: i18n.__({ phrase: 'LOSE_AND_RELAX', locale: params.language }),\n    WISTIKI: i18n.__({ phrase: 'WISTIKI', locale: params.language }),\n  });\n  const email = {\n    from: 'L\\'équipe Wistiki <notification@wistiki.com>',\n    to: params.email,\n    subject: i18n.__({\n      phrase: 'MAIL_POSITION_UPDATE_SUBJECT',\n      locale: params.language,\n    }, `${params.wistiki}`),\n    html,\n  };\n  return new Promise((resolve, reject) => {\n    transport.sendMail(email, (err, info) => {\n      if (err) {\n        reject(err);\n      }\n      resolve(info);\n    });\n  });\n}\n\nexport default {\n  sendAccountConfirmationEmail: accountConfirmationEmail,\n  sendPromoWistiKeys: promoWistiKeys,\n  sendForgotPasswordEmail: forgotPasswordEmail,\n  sendNewFriendEmail: newFriendEmail,\n  sendFoundWistikiEmail: foundWistikiEmail,\n  sendTutoEmail: tutoEmail,\n  sendPositionUpdateEmail: positionUpdateEmail,\n};\n"],"sourceRoot":"/opt/atlassian/pipelines/agent/build/src"}
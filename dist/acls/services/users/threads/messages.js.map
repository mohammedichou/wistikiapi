{"version":3,"sources":["acls/services/users/threads/messages.js"],"names":["UserThreadMessagesServicePermission","acl","allow","user","req","resolve","reject","email","params","ThreadHasUser","findAll","where","user_email","thread_id","tid","then","threads","length","Permission"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;IAEqBA,mC;;;AACpB,8CAAYC,GAAZ,EAAiB;AAAA;AAAA,yLACVA,GADU,EACL,qCADK,EACkC,CAAC,MAAD,CADlC;AAEhB;;;;0BAEO;AACP,QAAKC,KAAL,CAAW,MAAX,EAAmB,CAAC,MAAD,CAAnB,EAA6B,UAACC,IAAD,EAAOC,GAAP;AAAA,WAAe,sBAC3C,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpB,SAAIH,KAAKI,KAAL,IAAcH,IAAII,MAAJ,CAAWD,KAA7B,EACC,OAAOD,QAAP;AACDG,uBAAcC,OAAd,CAAsB;AACrBC,aAAO;AACNC,mBAAYR,IAAII,MAAJ,CAAWD,KADjB;AAENM,kBAAWT,IAAII,MAAJ,CAAWM;AAFhB;AADc,MAAtB,EAKGC,IALH,CAMC,UAACC,OAAD,EAAa;AACZ,UAAIA,QAAQC,MAAR,IAAkB,CAAtB,EAAyB;AACxB,cAAOX,QAAP;AACA;AACD,aAAOD,SAAP;AACA,MAXF;AAaA,KAjB0C,CAAf;AAAA,IAA7B;AAmBA;;;EAzB+Da,oB;;kBAA5ClB,mC","file":"messages.js","sourcesContent":["import Permission from '../../../permission';\nimport {ThreadHasUser} from '../../../../db';\n\nexport default class UserThreadMessagesServicePermission extends Permission {\n\tconstructor(acl) {\n\t\tsuper(acl, '/users/:email/threads/:tid/messages', ['POST']);\n\t}\n\n\tbuild() {\n\t\tthis.allow('user', ['POST'], (user, req) => new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tif (user.email != req.params.email)\n\t\t\t\t\treturn reject();\n\t\t\t\tThreadHasUser.findAll({\n\t\t\t\t\twhere: {\n\t\t\t\t\t\tuser_email: req.params.email,\n\t\t\t\t\t\tthread_id: req.params.tid\n\t\t\t\t\t}\n\t\t\t\t}).then(\n\t\t\t\t\t(threads) => {\n\t\t\t\t\t\tif (threads.length == 0) {\n\t\t\t\t\t\t\treturn reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn resolve();\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t));\n\t}\n}\n"],"sourceRoot":"/opt/atlassian/pipelines/agent/build/src"}
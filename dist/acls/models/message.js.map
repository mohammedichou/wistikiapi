{"version":3,"sources":["acls/models/message.js"],"names":["MessageModelPermission","acl","allow","user","model","resolve","reject","get","getThread","then","thread","getParticipants","where","email","participants","length","Permission"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;IAEqBA,sB;;;AACpB,iCAAYC,GAAZ,EAAiB;AAAA;AAAA,+JACVA,GADU,EACL,SADK,EACM,CAAC,KAAD,EAAQ,QAAR,EAAkB,QAAlB,EAA4B,QAA5B,EAAsC,MAAtC,CADN;AAEhB;;;;0BAEO;AACP,QAAKC,KAAL,CAAW,MAAX,EAAmB,CAAC,KAAD,CAAnB,EAA4B,UAACC,IAAD,EAAOC,KAAP;AAAA,WAAiB,sBAC5C,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpB,SAAIH,KAAKI,GAAL,CAAS,OAAT,KAAqBH,MAAMG,GAAN,CAAU,YAAV,CAAzB,EACC,OAAOF,SAAP,CADD,KAEI;AACH,aAAOD,MAAMI,SAAN,GAAkBC,IAAlB,CACN,kBAAU;AACT,cAAOC,OAAOC,eAAP,CAAuB;AAC7BC,eAAO;AACNC,gBAAOV,KAAKI,GAAL,CAAS,OAAT;AADD;AADsB,QAAvB,EAIJE,IAJI,CAKN,wBAAgB;AACf,YAAGK,aAAaC,MAAhB,EACC,OAAOV,SAAP;AACD,eAAOC,QAAP;AACA,QATK,CAAP;AAWA,OAbK,CAAP;AAeA;AACD,KArB2C,CAAjB;AAAA,IAA5B;AAuBA;;;EA7BkDU,oB;;kBAA/BhB,sB","file":"message.js","sourcesContent":["import Permission from '../permission';\n\nexport default class MessageModelPermission extends Permission {\n\tconstructor(acl) {\n\t\tsuper(acl, 'message', ['get', 'create', 'update', 'remove', 'find']);\n\t}\n\n\tbuild() {\n\t\tthis.allow('user', ['get'], (user, model) => new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tif (user.get('email') == model.get('user_email'))\n\t\t\t\t\treturn resolve();\n\t\t\t\telse{\n\t\t\t\t\treturn model.getThread().then(\n\t\t\t\t\t\tthread => {\n\t\t\t\t\t\t\treturn thread.getParticipants({\n\t\t\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\t\t\temail: user.get('email')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).then(\n\t\t\t\t\t\t\t\tparticipants => {\n\t\t\t\t\t\t\t\t\tif(participants.length)\n\t\t\t\t\t\t\t\t\t\treturn resolve();\n\t\t\t\t\t\t\t\t\treturn reject();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t));\n\t}\n}\n\n\n"],"sourceRoot":"/opt/atlassian/pipelines/agent/build/src"}
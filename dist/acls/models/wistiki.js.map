{"version":3,"sources":["acls/models/wistiki.js"],"names":["debug","require","WistikiPermission","acl","allow","user","wistiki","WistikiHasFriend","getUserPairing","email","serial_number","friendPairing","ownerPairing","WistikiHasOwner","reject","resolve","Permission"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;AACA,IAAMA,QAAQC,QAAQ,OAAR,EAAiB,4BAAjB,CAAd;;IAEqBC,iB;;;AACnB,6BAAYC,GAAZ,EAAiB;AAAA;AAAA,uJACTA,GADS,EACJ,SADI,EACO,CAAC,KAAD,EAAQ,QAAR,EAAkB,QAAlB,EAA4B,QAA5B,EAAsC,MAAtC,EAA8C,YAA9C,EAA4D,eAA5D,EAA6E,oBAA7E,CADP;AAEhB;;;;4BAEO;AAAA;;AACN,WAAKC,KAAL,CAAW,MAAX,EAAmB,CAAC,KAAD,EAAQ,QAAR,EAAkB,eAAlB,CAAnB;AAAA,4FAAuD,iBAAOC,IAAP,EAAaC,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACzBC,wBAAiBC,cAAjB,CAC1BH,KAAKI,KADqB,EAE1BH,QAAQI,aAFkB,CADyB;;AAAA;AAC/CC,+BAD+C;AAK/CC,8BAL+C,GAKhCC,uBAAgBL,cAAhB,CAA+BH,KAAKI,KAApC,EAA2CH,QAAQI,aAAnD,CALgC;;AAAA,wBAMjD,CAACC,aAAD,IAAkB,CAACC,YAN8B;AAAA;AAAA;AAAA;;AAAA,mDAO5C,kBAAQE,MAAR,EAP4C;;AAAA;AAAA,mDAS9C,kBAAQC,OAAR,EAT8C;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAvD;;AAAA;AAAA;AAAA;AAAA;AAWA,WAAKX,KAAL,CAAW,MAAX,EAAmB,CAAC,YAAD,EAAe,oBAAf,CAAnB;AAAA,6FAAyD,kBAAOC,IAAP,EAAaC,OAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AACjDM,8BADiD,GAClCC,uBAAgBL,cAAhB,CAA+BH,KAAKI,KAApC,EAA2CH,QAAQI,aAAnD,CADkC;;AAAA,sBAElDE,YAFkD;AAAA;AAAA;AAAA;;AAAA,oDAG9C,kBAAQE,MAAR,EAH8C;;AAAA;AAAA,oDAKhD,kBAAQC,OAAR,EALgD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAzD;;AAAA;AAAA;AAAA;AAAA;AAOA,WAAKX,KAAL,CAAW,aAAX,EAA0B,CAAC,KAAD,EAAQ,QAAR,EAAkB,QAAlB,EAA4B,QAA5B,CAA1B;AACD;;;EAzB4CY,oB;;kBAA1Bd,iB","file":"wistiki.js","sourcesContent":["import Permission from '../permission';\nimport { WistikiHasFriend, WistikiHasOwner } from '../../db/index';\n\n// eslint-disable-next-line no-unused-vars\nconst debug = require('debug')('darwin:acls:models:wistiki');\n\nexport default class WistikiPermission extends Permission {\n  constructor(acl) {\n    super(acl, 'wistiki', ['get', 'create', 'update', 'remove', 'find', 'add_friend', 'remove_friend', 'transfer_ownership']);\n  }\n\n  build() {\n    this.allow('user', ['get', 'update', 'remove_friend'], async (user, wistiki) => {\n      const friendPairing = await WistikiHasFriend.getUserPairing(\n        user.email,\n        wistiki.serial_number,\n      );\n      const ownerPairing = WistikiHasOwner.getUserPairing(user.email, wistiki.serial_number);\n      if (!friendPairing && !ownerPairing) {\n        return Promise.reject();\n      }\n      return Promise.resolve();\n    });\n    this.allow('user', ['add_friend', 'transfer_ownership'], async (user, wistiki) => {\n      const ownerPairing = WistikiHasOwner.getUserPairing(user.email, wistiki.serial_number);\n      if (!ownerPairing) {\n        return Promise.reject();\n      }\n      return Promise.resolve();\n    });\n    this.allow('application', ['get', 'update', 'create', 'remove']);\n  }\n}\n\n"],"sourceRoot":"/opt/atlassian/pipelines/agent/build/src"}
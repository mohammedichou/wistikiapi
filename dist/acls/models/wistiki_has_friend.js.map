{"version":3,"sources":["acls/models/wistiki_has_friend.js"],"names":["WistikiHasFriendModelPermission","acl","allow","user","wistiki_has_friend","resolve","reject","email","get","getWistiki","then","wistiki","getOwner","owners","owner","Permission"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;IAEqBA,+B;;;AACnB,2CAAYC,GAAZ,EAAiB;AAAA;AAAA,mLACTA,GADS,EACJ,oBADI,EACkB,CAAC,KAAD,EAAQ,QAAR,EAAkB,QAAlB,EAA4B,QAA5B,EAAsC,MAAtC,CADlB;AAEhB;;;;4BAEO;AACN,WAAKC,KAAL,CAAW,MAAX,EAAmB,CAAC,QAAD,CAAnB,EAA+B,UAACC,IAAD,EAAOC,kBAAP;AAAA,eAA8B,sBAC3D,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACnB,cAAIH,KAAKI,KAAL,IAAcH,mBAAmBI,GAAnB,CAAuB,YAAvB,CAAlB,EAAwD;AACtD,mBAAOH,SAAP;AACD,WAFD,MAEO;AACL,mBAAOD,mBAAmBK,UAAnB,GAAgCC,IAAhC,CACL,UAACC,OAAD,EAAa;AACX,qBAAOA,QAAQC,QAAR,EAAP;AACD,aAHI,EAILF,IAJK,CAKL,UAACG,MAAD,EAAY;AACV,kBAAIC,QAAQD,OAAO,CAAP,CAAZ;AACA,kBAAIC,MAAMN,GAAN,CAAU,OAAV,KAAsBL,KAAKI,KAA/B,EAAsC;AACpC,uBAAOF,SAAP;AACD;AACD,qBAAOC,QAAP;AACD,aAXI,CAAP;AAaD;AACF,SAnB0D,CAA9B;AAAA,OAA/B;AAqBD;;;EA3B0DS,oB;;kBAAxCf,+B","file":"wistiki_has_friend.js","sourcesContent":["import Permission from '../permission';\n\nexport default class WistikiHasFriendModelPermission extends Permission {\n  constructor(acl) {\n    super(acl, 'wistiki_has_friend', ['get', 'create', 'update', 'remove', 'find']);\n  }\n\n  build() {\n    this.allow('user', ['remove'], (user, wistiki_has_friend) => new Promise(\n      (resolve, reject) => {\n        if (user.email == wistiki_has_friend.get('user_email')) {\n          return resolve();\n        } else {\n          return wistiki_has_friend.getWistiki().then(\n            (wistiki) => {\n              return wistiki.getOwner();\n            }\n          ).then(\n            (owners) => {\n              let owner = owners[0];\n              if (owner.get('email') == user.email) {\n                return resolve();\n              }\n              return reject();\n            }\n          );\n        }\n      }\n    ));\n  }\n}\n\n\n"],"sourceRoot":"/opt/atlassian/pipelines/agent/build/src"}
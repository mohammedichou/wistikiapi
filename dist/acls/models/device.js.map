{"version":3,"sources":["acls/models/device.js"],"names":["DeviceModelPermission","acl","allow","user","device","DeviceHasUser","getDevicePairing","email","uid","devicePairing","reject","resolve","Permission"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;IAEqBA,qB;;;AACnB,iCAAYC,GAAZ,EAAiB;AAAA;AAAA,+JACTA,GADS,EACJ,QADI,EACM,CAAC,KAAD,EAAQ,QAAR,EAAkB,QAAlB,EAA4B,QAA5B,EAAsC,MAAtC,CADN;AAEhB;;;;4BAEO;AAAA;;AACN,WAAKC,KAAL,CAAW,MAAX,EAAmB,CAAC,MAAD,CAAnB;AACA,WAAKA,KAAL,CAAW,MAAX,EAAmB,CAAC,KAAD,EAAQ,QAAR,EAAkB,QAAlB,CAAnB;AAAA,4FAAgD,iBAAOC,IAAP,EAAaC,MAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAClBC,kBAAcC,gBAAd,CAA+BH,KAAKI,KAApC,EAA2CH,OAAOI,GAAlD,CADkB;;AAAA;AACxCC,+BADwC;;AAAA,sBAEzCA,aAFyC;AAAA;AAAA;AAAA;;AAAA,mDAGrC,kBAAQC,MAAR,EAHqC;;AAAA;AAAA,mDAKvC,kBAAQC,OAAR,EALuC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAhD;;AAAA;AAAA;AAAA;AAAA;AAOD;;;EAdgDC,oB;;kBAA9BZ,qB","file":"device.js","sourcesContent":["import Permission from '../permission';\nimport { DeviceHasUser } from '../../db';\n\nexport default class DeviceModelPermission extends Permission {\n  constructor(acl) {\n    super(acl, 'device', ['get', 'create', 'update', 'remove', 'find']);\n  }\n\n  build() {\n    this.allow('user', ['find']);\n    this.allow('user', ['get', 'update', 'remove'], async (user, device) => {\n      const devicePairing = await DeviceHasUser.getDevicePairing(user.email, device.uid);\n      if (!devicePairing) {\n        return Promise.reject();\n      }\n      return Promise.resolve();\n    });\n  }\n}\n\n"],"sourceRoot":"/opt/atlassian/pipelines/agent/build/src"}